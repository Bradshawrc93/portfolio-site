{% extends 'base.html' %}

{% block title %}{{ project.title }} | Cody Bradshaw{% endblock %}

{% block content %}
<div class="container">
    <div class="project-header">
        <h1>{{ project.title }}</h1>
        <p class="card-meta">{{ project.tagline }}</p>
        <div class="tags">
            {% for tech in project.get_stack_list %}
            <span class="tag">{{ tech }}</span>
            {% endfor %}
        </div>
        <div class="project-meta">
            {% if project.demo_url %}
            <a href="{{ project.demo_url }}" target="_blank" rel="noopener" class="btn">View Demo</a>
            {% endif %}
            <a href="https://github.com/{{ project.repo_full_name }}" target="_blank" rel="noopener" class="btn btn-secondary">View on GitHub</a>
        </div>
    </div>

    {% if has_activity_data %}
    <div class="activity-line-chart">
        <h2 class="activity-chart-title">Repository Activity (Last 90 Days)</h2>
        <div class="line-chart-container">
            <svg class="line-chart" viewBox="0 0 800 200" preserveAspectRatio="none">
                <defs>
                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:var(--accent);stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:var(--accent);stop-opacity:0" />
                    </linearGradient>
                </defs>
                <polyline
                    class="line-chart-area"
                    fill="url(#lineGradient)"
                    points="{% for item in activity_data %}{% widthratio forloop.counter0|add:1 activity_data|length 800 %},{% widthratio item.commits max_commits 180 %}{% if not forloop.last %} {% endif %}{% endfor %}">
                </polyline>
                <polyline
                    class="line-chart-line"
                    fill="none"
                    stroke="var(--accent)"
                    stroke-width="2"
                    points="{% for item in activity_data %}{% widthratio forloop.counter0|add:1 activity_data|length 800 %},{% widthratio item.commits max_commits 180 %}{% if not forloop.last %} {% endif %}{% endfor %}">
                </polyline>
                {% for item in activity_data %}
                <circle
                    class="line-chart-point"
                    cx="{% widthratio forloop.counter0|add:1 activity_data|length 800 %}"
                    cy="{% widthratio item.commits max_commits 180 %}"
                    r="3"
                    fill="var(--accent)"
                    data-date="{{ item.day|date:'M d, Y' }}"
                    data-count="{{ item.commits }}"
                    title="{{ item.day|date:'M d, Y' }}: {{ item.commits }} commits">
                </circle>
                {% endfor %}
            </svg>
            <div class="line-chart-x-axis">
                {% for item in activity_data %}
                    {% if forloop.counter0|divisibleby:15 or forloop.last %}
                    <span class="x-axis-label" style="left: {% widthratio forloop.counter0|add:1 activity_data|length 100 %}%;">{{ item.day|date:"M d" }}</span>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if snapshot and snapshot.readme_content %}
    <section class="section readme-section">
        <h2 class="section-title">README</h2>
        <div class="readme-content">
            {{ readme_html|safe }}
        </div>
    </section>
    {% endif %}

    {% if snapshot and snapshot.description %}
    <section class="section">
        <h2 class="section-title">About</h2>
        <p>{{ snapshot.description }}</p>
    </section>
    {% endif %}

    {% if related_posts %}
    <section class="section">
        <h2 class="section-title">Related Devlog Posts</h2>
        <ul class="devlog-list">
            {% for post in related_posts %}
            <li class="devlog-item">
                <h3><a href="{% url 'devlog_detail' slug=post.slug %}">{{ post.title }}</a></h3>
                <div class="devlog-meta">
                    {% if post.published_at %}
                    {{ post.published_at|date:"F d, Y" }}
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
    </section>
    {% endif %}
</div>
{% endblock %}

